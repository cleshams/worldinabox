window.CMB2=function(i,t,p,f){"use strict";var s=i.cmb2_l10,d=i.setTimeout,u={formfield:"",idNumber:!1,file_frames:{},repeatEls:'input:not([type="button"]),select,textarea,.cmb2-media-status',styleBreakPoint:450,mediaHandlers:{},neweditor_id:[],defaults:{time_picker:s.defaults.time_picker,date_picker:s.defaults.date_picker,color_picker:s.defaults.color_picker||{}}},c=function(e){return p(t.getElementById(e))};return u.metabox=function(){return u.$metabox||(u.$metabox=p(".cmb2-wrap > .cmb2-metabox")),u.$metabox},u.init=function(){u.log("CMB2 localized data",s);var e=u.metabox(),t=e.find(".cmb-repeatable-group");u.initPickers(e.find('input[type="text"].cmb2-timepicker'),e.find('input[type="text"].cmb2-datepicker'),e.find('input[type="text"].cmb2-colorpicker')),c("ui-datepicker-div").wrap('<div class="cmb2-element" />'),p('<p><span class="button cmb-multicheck-toggle">'+s.strings.check_toggle+"</span></p>").insertBefore(".cmb2-checkbox-list:not(.no-select-all)"),u.makeListSortable(),e.on("change",".cmb2_upload_file",function(){u.formfield=p(this).attr("id"),c(u.formfield+"_id").val("")}).on("click",".cmb-multicheck-toggle",u.toggleCheckBoxes).on("click",".cmb2-upload-button",u.handleMedia).on("click",".cmb-attach-list li, .cmb2-media-status .img-status img, .cmb2-media-status .file-status > span",u.handleFileClick).on("click",".cmb2-remove-file-button",u.handleRemoveMedia).on("click",".cmb-add-group-row",u.addGroupRow).on("click",".cmb-add-row-button",u.addAjaxRow).on("click",".cmb-remove-group-row",u.removeGroupRow).on("click",".cmb-remove-row-button",u.removeAjaxRow).on("keyup paste focusout",".cmb2-oembed",u.maybeOembed).on("cmb2_remove_row",".cmb-repeatable-group",u.resetTitlesAndIterator).on("click",".cmbhandle, .cmbhandle + .cmbhandle-title",u.toggleHandle),t.length&&t.filter(".sortable").each(function(){p(this).find(".button.cmb-remove-group-row").before('<a class="button cmb-shift-rows move-up alignleft" href="#"><span class="'+s.up_arrow_class+'"></span></a> <a class="button cmb-shift-rows move-down alignleft" href="#"><span class="'+s.down_arrow_class+'"></span></a>')}).on("click",".cmb-shift-rows",u.shiftRows).on("cmb2_add_row",u.emptyValue),d(u.resizeoEmbeds,500),p(i).on("resize",u.resizeoEmbeds)},u.resetTitlesAndIterator=function(){p(".cmb-repeatable-group").each(function(){var i=p(this);i.find(".cmb-repeatable-grouping").each(function(e){var t=p(this);t.data("iterator",e),t.find(".cmb-group-title h4").text(i.find(".cmb-add-group-row").data("grouptitle").replace("{#}",e+1))})})},u.toggleHandle=function(e){e.preventDefault(),p(t).trigger("postbox-toggled",p(this).parent(".postbox").toggleClass("closed"))},u.toggleCheckBoxes=function(e){e.preventDefault();var t=p(this),i=t.closest(".cmb-td").find("input[type=checkbox]");t.data("checked")?(i.prop("checked",!1),t.data("checked",!1)):(i.prop("checked",!0),t.data("checked",!0))},u.handleMedia=function(e){e.preventDefault();var t=p(this);u.attach_id=!t.hasClass("cmb2-upload-list")&&t.closest(".cmb-td").find(".cmb2-upload-file-id").val(),u.attach_id="0"!==u.attach_id&&u.attach_id,u._handleMedia(t.prev("input.cmb2-upload-file").attr("id"),t.hasClass("cmb2-upload-list"))},u.handleFileClick=function(e){e.preventDefault();var t=p(this),i=t.closest(".cmb-td"),a=i.find(".cmb2-upload-button").hasClass("cmb2-upload-list");u.attach_id=a?t.find('input[type="hidden"]').data("id"):i.find(".cmb2-upload-file-id").val(),u.attach_id&&u._handleMedia(i.find("input.cmb2-upload-file").attr("id"),a,u.attach_id)},u._handleMedia=function(e,i){if(wp){var t=u.metabox();u.formfield=e;var a=c(u.formfield),r=a.data("previewsize"),n=a.attr("name"),o=!0,l=!0;if(u.formfield in u.file_frames)return void u.file_frames[u.formfield].open();u.file_frames[u.formfield]=wp.media({title:t.find("label[for="+u.formfield+"]").text(),button:{text:s.strings.upload_file},multiple:!!i}),u.mediaHandlers.list=function(e,t){l=e.toJSON(),a.val(l.url),c(u.formfield+"_id").val(l.id);var i=[];return p(l).each(function(){if(this.type&&"image"===this.type){var e=r[0]?r[0]:50,t=r[1]?r[1]:50;o='<li class="img-status"><img width="'+e+'" height="'+t+'" src="'+this.url+'" class="attachment-'+e+"px"+t+'px" alt="'+this.filename+'"><p><a href="#" class="cmb2-remove-file-button" rel="'+u.formfield+"["+this.id+']">'+s.strings.remove_image+'</a></p><input type="hidden" id="filelist-'+this.id+'" data-id="'+this.id+'" name="'+n+"["+this.id+']" value="'+this.url+'"></li>'}else o='<li class="file-status"><span>'+s.strings.file+" <strong>"+this.filename+'</strong></span>&nbsp;&nbsp; (<a href="'+this.url+'" target="_blank" rel="external">'+s.strings.download+'</a> / <a href="#" class="cmb2-remove-file-button" rel="'+u.formfield+"["+this.id+']">'+s.strings.remove_file+'</a>)<input type="hidden" id="filelist-'+this.id+'" data-id="'+this.id+'" name="'+n+"["+this.id+']" value="'+this.url+'"></li>';i.push(o)}),t?i:void p(i).each(function(){a.siblings(".cmb2-media-status").slideDown().append(this)})},u.mediaHandlers.single=function(e){if(l=e.first().toJSON(),a.val(l.url),c(u.formfield+"_id").val(l.id),l.type&&"image"===l.type){var t=r[0]?r[0]:350;o='<div class="img-status"><img width="'+t+'px" style="max-width: '+t+'px; width: 100%; height: auto;" src="'+l.url+'" alt="'+l.filename+'" title="'+l.filename+'" /><p><a href="#" class="cmb2-remove-file-button" rel="'+u.formfield+'">'+s.strings.remove_image+"</a></p></div>"}else o='<div class="file-status"><span>'+s.strings.file+" <strong>"+l.filename+'</strong></span>&nbsp;&nbsp; (<a href="'+l.url+'" target="_blank" rel="external">'+s.strings.download+'</a> / <a href="#" class="cmb2-remove-file-button" rel="'+u.formfield+'">'+s.strings.remove_file+"</a>)</div>";a.siblings(".cmb2-media-status").slideDown().html(o)},u.mediaHandlers.selectFile=function(){var e=u.file_frames[u.formfield].state().get("selection"),t=i?"list":"single";return u.attach_id&&i?void p('[data-id="'+u.attach_id+'"]').parents("li").replaceWith(u.mediaHandlers.list(e,!0)):void u.mediaHandlers[t](e)},u.mediaHandlers.openModal=function(){var e=u.file_frames[u.formfield].state().get("selection");if(!u.attach_id)return e.reset();var t=wp.media.attachment(u.attach_id);t.fetch(),e.set(t?[t]:[])},u.file_frames[u.formfield].on("select",u.mediaHandlers.selectFile).on("open",u.mediaHandlers.openModal),u.file_frames[u.formfield].open()}},u.handleRemoveMedia=function(e){e.preventDefault();var t=p(this);return t.is(".cmb-attach-list .cmb2-remove-file-button")?t.parents("li").remove():(u.formfield=t.attr("rel"),u.metabox().find("input#"+u.formfield).val(""),u.metabox().find("input#"+u.formfield+"_id").val(""),t.parents(".cmb2-media-status").html("")),!1},u.cleanRow=function(r,m,e){var t=r.find('input:not([type="button"]), select, textarea, label'),i=r.find("[id]").not('input:not([type="button"]), select, textarea, label');return e&&(r.find(".cmb-repeat-table .cmb-repeat-row:not(:first-child)").remove(),i.length&&i.each(function(){var e=p(this),t=e.attr("id"),i=t.replace("_"+m,"_"+u.idNumber),a=r.find('[data-selector="'+t+'"]');e.attr("id",i),a.length&&a.attr("data-selector",i).data("selector",i)})),u.neweditor_id=[],t.filter(":checked").prop("checked",!1),t.filter(":selected").prop("selected",!1),r.find("h3.cmb-group-title").length&&r.find("h3.cmb-group-title").text(r.data("title").replace("{#}",u.idNumber+1)),t.each(function(){var e,t,i=p(this),a=i.hasClass("wp-editor-area"),r=i.attr("for"),n=i.attr("value"),o={};if(r)o={for:r.replace("_"+m,"_"+u.idNumber)};else{var l=i.attr("name"),s=l?l.replace("["+m+"]","["+u.idNumber+"]"):"";o={id:e=(t=i.attr("id"))?t.replace("_"+m,"_"+u.idNumber):"",name:s,"data-iterator":u.idNumber}}if(f!==typeof n&&n&&(o.value=""),"TEXTAREA"===i.prop("tagName")&&i.html(""),i.removeClass("hasDatepicker").attr(o).val(""),a){e=e?t.replace("zx"+m,"zx"+u.idNumber):"",i.html("");var d=i.parents(".cmb-type-wysiwyg");d.find(".mce-tinymce:not(:first-child)").remove();var c=d.html().replace(new RegExp(t,"g"),e);d.html(c),u.neweditor_id.push({id:e,old:t})}}),u},u.newRowHousekeeping=function(e){var t=e.find(".wp-picker-container"),i=e.find(".cmb2-media-status");return t.length&&t.each(function(){var e=p(this).parent();e.html(e.find('input[type="text"].cmb2-colorpicker').attr("style",""))}),i.length&&i.empty(),u},u.afterRowInsert=function(e){var t,i;if(u.neweditor_id.length)for(i=u.neweditor_id.length-1;0<=i;i--){var a=u.neweditor_id[i].id,r=u.neweditor_id[i].old;if(void 0===tinyMCEPreInit.mceInit[a]){var n=jQuery.extend({},tinyMCEPreInit.mceInit[r]);for(t in n)"string"==typeof n[t]&&(n[t]=n[t].replace(new RegExp(r,"g"),a));tinyMCEPreInit.mceInit[a]=n}if(void 0===tinyMCEPreInit.qtInit[a]){var o=jQuery.extend({},tinyMCEPreInit.qtInit[r]);for(t in o)"string"==typeof o[t]&&(o[t]=o[t].replace(new RegExp(r,"g"),a));tinyMCEPreInit.qtInit[a]=o}tinyMCE.init({id:tinyMCEPreInit.mceInit[a]})}u.initPickers(e.find('input[type="text"].cmb2-timepicker'),e.find('input[type="text"].cmb2-datepicker'),e.find('input[type="text"].cmb2-colorpicker'))},u.updateNameAttr=function(){var e=p(this),t=e.attr("name");if(void 0===t)return!1;var i=parseInt(e.parents(".cmb-repeatable-grouping").data("iterator")),a=i-1,r=t.replace("["+i+"]","["+a+"]");e.attr("name",r)},u.emptyValue=function(e,t){p('input:not([type="button"]), textarea',t).val("")},u.addGroupRow=function(e){e.preventDefault();var t=p(this);t.trigger("cmb2_add_group_row_start",t);var i=c(t.data("selector")),a=i.find(".cmb-repeatable-grouping").last(),r=parseInt(a.data("iterator"));u.idNumber=r+1;var n=a.clone();u.newRowHousekeeping(n.data("title",t.data("grouptitle"))).cleanRow(n,r,!0),n.find(".cmb-add-row-button").prop("disabled",!1);var o=p('<div class="postbox cmb-row cmb-repeatable-grouping" data-iterator="'+u.idNumber+'">'+n.html()+"</div>");a.after(o),u.afterRowInsert(o),i.find(".cmb-repeatable-grouping").length<=1?i.find(".cmb-remove-group-row").prop("disabled",!0):i.find(".cmb-remove-group-row").prop("disabled",!1),i.trigger("cmb2_add_row",o)},u.addAjaxRow=function(e){e.preventDefault();var t=p(this),i=c(t.data("selector")),a=i.find(".empty-row"),r=parseInt(a.find("[data-iterator]").data("iterator"));u.idNumber=r+1;var n=a.clone();u.newRowHousekeeping(n).cleanRow(n,r),a.removeClass("empty-row hidden").addClass("cmb-repeat-row"),a.after(n),u.afterRowInsert(n),i.trigger("cmb2_add_row",n),i.find(".cmb-remove-row-button").removeClass("button-disabled")},u.removeGroupRow=function(e){e.preventDefault();var t=p(this),i=c(t.data("selector")),a=t.parents(".cmb-repeatable-grouping"),r=i.find(".cmb-repeatable-grouping").length;1<r&&(i.trigger("cmb2_remove_group_row_start",t),a.nextAll(".cmb-repeatable-grouping").find(u.repeatEls).each(u.updateNameAttr),a.remove(),r<=2?i.find(".cmb-remove-group-row").prop("disabled",!0):i.find(".cmb-remove-group-row").prop("disabled",!1),i.trigger("cmb2_remove_row"))},u.removeAjaxRow=function(e){e.preventDefault();var t=p(this);if(!t.hasClass("button-disabled")){var i=t.parents(".cmb-row"),a=t.parents(".cmb-repeat-table"),r=a.find(".cmb-row").length;2<r?(i.hasClass("empty-row")&&i.prev().addClass("empty-row").removeClass("cmb-repeat-row"),t.parents(".cmb-repeat-table .cmb-row").remove(),3===r&&a.find(".cmb-remove-row-button").addClass("button-disabled"),a.trigger("cmb2_remove_row")):t.addClass("button-disabled")}},u.shiftRows=function(e){e.preventDefault();var t=p(this);t.trigger("cmb2_shift_rows_enter",t);var i=t.parents(".cmb-repeatable-grouping"),a=t.hasClass("move-up")?i.prev(".cmb-repeatable-grouping"):i.next(".cmb-repeatable-grouping");if(a.length){t.trigger("cmb2_shift_rows_start",t);var r=[];i.find(u.repeatEls).each(function(){var e,t=p(this);e=t.hasClass("cmb2-media-status")?t.html():"checkbox"===t.attr("type")||"radio"===t.attr("type")?t.is(":checked"):"select"===t.prop("tagName")?t.is(":selected"):t.val(),r.push({val:e,$:t})}),a.find(u.repeatEls).each(function(e){var t,i=p(this);i.hasClass("cmb2-media-status")?(t=i.html(),i.html(r[e].val),r[e].$.html(t)):"checkbox"===i.attr("type")||"radio"===i.attr("type")?(r[e].$.prop("checked",i.is(":checked")),i.prop("checked",r[e].val)):"select"===i.prop("tagName")?(r[e].$.prop("selected",i.is(":selected")),i.prop("selected",r[e].val)):(r[e].$.val(i.val()),i.val(r[e].val))}),t.trigger("cmb2_shift_rows_complete",t)}},u.initPickers=function(e,t,i){u.initTimePickers(e),u.initDatePickers(t),u.initColorPickers(i)},u.initTimePickers=function(e){e.length&&(e.timepicker("destroy"),e.timepicker(u.defaults.time_picker))},u.initDatePickers=function(e){e.length&&(e.datepicker("destroy"),e.datepicker(u.defaults.date_picker))},u.initColorPickers=function(e){e.length&&("object"==typeof jQuery.wp&&"function"==typeof jQuery.wp.wpColorPicker?e.wpColorPicker(u.defaults.color_picker):e.each(function(e){p(this).after('<div id="picker-'+e+'" style="z-index: 1000; background: #EEE; border: 1px solid #CCC; position: absolute; display: block;"></div>'),c("picker-"+e).hide().farbtastic(p(this))}).focus(function(){p(this).next().show()}).blur(function(){p(this).next().hide()}))},u.makeListSortable=function(){var e=u.metabox().find(".cmb2-media-status.cmb-attach-list");e.length&&e.sortable({cursor:"move"}).disableSelection()},u.maybeOembed=function(i){var t=p(this),e,a;({focusout:function(){d(function(){u.spinner(".postbox .cmb2-metabox",!0)},2e3)},keyup:function(){var e=function(e,t){return i.which<=t&&i.which>=e};(e(48,90)||e(96,111)||e(8,9)||187===i.which||190===i.which)&&u.doAjax(t,i)},paste:function(){d(function(){u.doAjax(t)},100)}})[i.type]()},u.resizeoEmbeds=function(){u.metabox().each(function(){var e=p(this),t=e.parents(".inside"),i=e.parents(".inner-sidebar").length||e.parents("#side-sortables").length,n=i,a=!1;if(!t.length)return!0;var o=t.width();u.styleBreakPoint>o&&(n=!0,a=u.styleBreakPoint-62>o);var l=(o=n?o:Math.round(.82*t.width()*.97))-30;if(!n||i||a||(l-=75),639<l)return!0;var r,s=e.find(".cmb-type-oembed .embed-status").children().not(".cmb2-remove-wrapper");return!s.length||void s.each(function(){var e=p(this),t=e.width(),i=e.height(),a=l;e.parents(".cmb-repeat-row").length&&!n&&(a=l-91,a=o<785?a-15:a);var r=Math.round(a*i/t);e.width(a).height(r)})})},u.log=function(){s.script_debug&&console&&"function"==typeof console.log&&console.log.apply(console,arguments)},u.spinner=function(e,t){t?p(".cmb-spinner",e).hide():p(".cmb-spinner",e).show()},u.doAjax=function(e){var t=e.val();if(!(t.length<6)){var i=e.attr("id"),a=e.closest(".cmb-td"),r=a.find(".embed-status"),n=a.find(".embed_wrap"),o=r.find(":first-child"),l=r.length&&o.length?o.width():e.width();u.log("oembed_url",t,i),u.spinner(a),n.html(""),d(function(){p(".cmb2-oembed:focus").val()===t&&p.ajax({type:"post",dataType:"json",url:s.ajaxurl,data:{action:"cmb2_oembed_handler",oembed_url:t,oembed_width:300<l?l:300,field_id:i,object_id:e.data("objectid"),object_type:e.data("objecttype"),cmb2_ajax_nonce:s.ajax_nonce},success:function(e){u.log(e),u.spinner(a,!0),n.html(e.data)}})},500)}},p(t).ready(u.init),u}(window,document,jQuery);